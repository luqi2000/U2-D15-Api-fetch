<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Bootstrap demo</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid px-5">
        <a class="navbar-brand" href="#">Little Amazon</a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto d-flex flex-grow-1 mb-2 mb-lg-0">
            <li class="nav-item me-auto">
              <a class="nav-link active" aria-current="page" href="homepage.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="back-office.html">Backoffice</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container">
      <div id="todo" class="row">
        <div class="col">nessun dato</div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"></script>
    <script>
      const URLParams = new URLSearchParams(window.location.search);

      const selectedId = URLParams.get("id");
      console.log("SELECTED ID: ", selectedId);

      fetch("https://striveschool-api.herokuapp.com/api/product/" + selectedId, {
        headers: {
          Authorization:
            "Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJfaWQiOiI2NDE0MzY0NGY4MWI0MjAwMTM5YjI4MGEiLCJpYXQiOjE2NzkwNDYyMTMsImV4cCI6MTY4MDI1NTgxM30.RxYeuOk4I_m-InIxjrQLsaiSDyWW2WUotXDfn3VUgkM"
        }
      })
        .then(response => {
          if (response.ok) {
            return response.json();
          } else {
            alert("qualcosa e' andato storto");
            throw new Error("qualcosa e' andato storto");
          }
        })

        .then(Data => {
          const { _id, name, description, brand, imageUrl, price } = Data;
          const start = document.getElementById("todo");
          start.innerHTML = "";

          const col = document.createElement("div");
          col.className = "col d-flex";
          col.innerHTML = `
            <div class="card">
                <img src="${imageUrl}" height="400" class="card-img-top" alt="..." />
            <div class="card-body">
                <h2 class="bg-light py-3 ps-2">Details</h2>
                    <ul class="list-group list-group-flush">
                        <li class="list-group-item ps-2"><strong>Nome:</strong> ${name}</li>
                        <li class="list-group-item ps-2"><strong>Brand:</strong> ${brand}</li>
                        <li class="list-group-item ps-2"><strong>Description:</strong> ${description}</li>
                        <li class="list-group-item ps-2"><strong>Price:</strong> ${price}</li>
                    </ul>
                <button class="btn btn-success mt-3" onclick="handleClick()">Modifica</button>
            </div>
            </div>`;
          start.appendChild(col);
        })
        .catch(error => console.log(error));

      const handleClick = () => {
        // il metodo .assign() sposta l'utente su un'altra pagina, come fosse un href su un <a>
        window.location.assign("back-office.html?id=" + selectedId);
      };
    </script>
  </body>
</html>
